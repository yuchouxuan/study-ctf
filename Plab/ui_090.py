from FrameBase import  *
class Ghp(CroDBase):
    x=[1,1,1]
    y =[1,1,1]
    xa=[1,1,1]
    ya = [1,1,1]
    xp =0
    yp=0
    xd=1
    yd=1

    def paintEvent(self, a0: QtGui.QPaintEvent) -> None:
        m = max(max(self.x),max(self.y),max(self.ya),max(self.xa))
        mi = abs(min(min(self.x),min(self.y),min(self.ya),min(self.xa)))
        self.xmax = max(m,mi,5)*1.5
        self.ymax = self.xmax
        qp = self.paintBeg()
        self.drwCord()
        for i in range(3):
            self.Point(self.x[i],self.y[i],10,col=col.cGreen2)
            self.Text(self.x[i],self.y[i],f'P{i+1}')
            j = (i+1)%3
            self.Line(self.x[i],self.y[i],self.x[j],self.y[j],2,col.cGreen,unlim=False)
            self.Point(self.xa[i], self.ya[i],10, col=col.cYellow2)
            self.Text(self.xa[i], self.ya[i], f'P{i+1}\'',fz=9)
            self.Line(self.xa[i], self.ya[i], self.xa[j], self.ya[j], 2, col.cYellow, unlim=False)

            self.Line(self.x[i], self.y[i], self.xa[i], self.ya[i], 1, col=col.cgray2, arror=True,unlim=False)

        self.paintEnd()
        super(Ghp, self).paintEvent(a0)
    pass


class Ui_Form(FrameBase):
    name="数学-坐标变换"
    def setupUi(self, cord):
        cord.setObjectName("cord")
        cord.resize(1203, 806)
        self.horizontalLayout_4 = QtWidgets.QHBoxLayout(cord)
        self.horizontalLayout_4.setObjectName("horizontalLayout_4")
        self.img =Ghp(cord)
        self.img.xmax = 20
        self.img.ymax =20
        self.img.setObjectName("img")
        self.horizontalLayout_4.addWidget(self.img)
        self.verticalLayout_5 = QtWidgets.QVBoxLayout()
        self.verticalLayout_5.setObjectName("verticalLayout_5")
        self.label_7 = QtWidgets.QLabel(cord)
        self.label_7.setMinimumSize(QtCore.QSize(0, 40))
        font = QtGui.QFont()
        font.setPointSize(14)
        self.label_7.setFont(font)
        self.label_7.setTextFormat(QtCore.Qt.AutoText)
        self.label_7.setAlignment(QtCore.Qt.AlignBottom|QtCore.Qt.AlignHCenter)
        self.label_7.setObjectName("label_7")
        self.verticalLayout_5.addWidget(self.label_7)
        self.line = QtWidgets.QFrame(cord)
        self.line.setFrameShape(QtWidgets.QFrame.HLine)
        self.line.setFrameShadow(QtWidgets.QFrame.Sunken)
        self.line.setObjectName("line")
        self.verticalLayout_5.addWidget(self.line)
        self.gridLayout_3 = QtWidgets.QGridLayout()
        self.gridLayout_3.setObjectName("gridLayout_3")
        self.laby1_3 = QtWidgets.QLabel(cord)
        self.laby1_3.setObjectName("laby1_3")
        self.gridLayout_3.addWidget(self.laby1_3, 0, 2, 1, 1)
        self.x3 = QtWidgets.QDoubleSpinBox(cord)
        self.x3.setMinimum(-10.0)
        self.x3.setMaximum(10.0)
        self.x3.setSingleStep(1.0)
        self.x3.setProperty("value", 1.0)
        self.x3.setObjectName("x3")
        self.gridLayout_3.addWidget(self.x3, 0, 1, 1, 1)
        self.label_3 = QtWidgets.QLabel(cord)
        self.label_3.setObjectName("label_3")
        self.gridLayout_3.addWidget(self.label_3, 0, 0, 1, 1)
        self.y3 = QtWidgets.QDoubleSpinBox(cord)
        self.y3.setMinimum(-10.0)
        self.y3.setMaximum(10.0)
        self.y3.setSingleStep(1.0)
        self.y3.setObjectName("y3")
        self.gridLayout_3.addWidget(self.y3, 0, 3, 1, 1)
        self.verticalLayout_5.addLayout(self.gridLayout_3)
        self.gridLayout = QtWidgets.QGridLayout()
        self.gridLayout.setObjectName("gridLayout")
        self.laby1 = QtWidgets.QLabel(cord)
        self.laby1.setObjectName("laby1")
        self.gridLayout.addWidget(self.laby1, 0, 2, 1, 1)
        self.x1 = QtWidgets.QDoubleSpinBox(cord)
        self.x1.setMinimum(-10.0)
        self.x1.setMaximum(10.0)
        self.x1.setSingleStep(1.0)
        self.x1.setObjectName("x1")
        self.gridLayout.addWidget(self.x1, 0, 1, 1, 1)
        self.label = QtWidgets.QLabel(cord)
        self.label.setObjectName("label")
        self.gridLayout.addWidget(self.label, 0, 0, 1, 1)
        self.y1 = QtWidgets.QDoubleSpinBox(cord)
        self.y1.setMinimum(-10.0)
        self.y1.setMaximum(10.0)
        self.y1.setSingleStep(1.0)
        self.y1.setProperty("value", 1.0)
        self.y1.setObjectName("y1")
        self.gridLayout.addWidget(self.y1, 0, 3, 1, 1)
        self.verticalLayout_5.addLayout(self.gridLayout)
        self.gridLayout_2 = QtWidgets.QGridLayout()
        self.gridLayout_2.setObjectName("gridLayout_2")
        self.x2 = QtWidgets.QDoubleSpinBox(cord)
        self.x2.setMinimum(-10.0)
        self.x2.setMaximum(10.0)
        self.x2.setSingleStep(1.0)
        self.x2.setProperty("value", -1.0)
        self.x2.setObjectName("x2")
        self.gridLayout_2.addWidget(self.x2, 0, 1, 1, 1)
        self.laby1_2 = QtWidgets.QLabel(cord)
        self.laby1_2.setObjectName("laby1_2")
        self.gridLayout_2.addWidget(self.laby1_2, 0, 2, 1, 1)
        self.label_2 = QtWidgets.QLabel(cord)
        self.label_2.setObjectName("label_2")
        self.gridLayout_2.addWidget(self.label_2, 0, 0, 1, 1)
        self.y2 = QtWidgets.QDoubleSpinBox(cord)
        self.y2.setMinimum(-10.0)
        self.y2.setMaximum(10.0)
        self.y2.setSingleStep(1.0)
        self.y2.setValue(-1)
        self.y2.setObjectName("y2")
        self.gridLayout_2.addWidget(self.y2, 0, 3, 1, 1)
        self.verticalLayout_5.addLayout(self.gridLayout_2)
        self.label_8 = QtWidgets.QLabel(cord)
        self.label_8.setMinimumSize(QtCore.QSize(0, 40))
        font = QtGui.QFont()
        font.setPointSize(14)
        self.label_8.setFont(font)
        self.label_8.setTextFormat(QtCore.Qt.AutoText)
        self.label_8.setAlignment(QtCore.Qt.AlignBottom|QtCore.Qt.AlignHCenter)
        self.label_8.setObjectName("label_8")
        self.verticalLayout_5.addWidget(self.label_8)
        self.line_2 = QtWidgets.QFrame(cord)
        self.line_2.setFrameShape(QtWidgets.QFrame.HLine)
        self.line_2.setFrameShadow(QtWidgets.QFrame.Sunken)
        self.line_2.setObjectName("line_2")
        self.verticalLayout_5.addWidget(self.line_2)
        self.horizontalLayout = QtWidgets.QHBoxLayout()
        self.horizontalLayout.setObjectName("horizontalLayout")
        self.verticalLayout = QtWidgets.QVBoxLayout()
        self.verticalLayout.setObjectName("verticalLayout")
        self.label_4 = QtWidgets.QLabel(cord)
        self.label_4.setAlignment(QtCore.Qt.AlignCenter)
        self.label_4.setObjectName("label_4")
        self.verticalLayout.addWidget(self.label_4)
        self.xp = QtWidgets.QDial(cord)
        self.xp.setMinimum(-100)
        self.xp.setMaximum(100)
        self.xp.setObjectName("xp")
        self.verticalLayout.addWidget(self.xp)
        self.lcdx = QtWidgets.QLCDNumber(cord)
        self.lcdx.setSegmentStyle(QtWidgets.QLCDNumber.Flat)
        self.lcdx.setObjectName("lcdx")
        self.verticalLayout.addWidget(self.lcdx)
        self.horizontalLayout.addLayout(self.verticalLayout)
        self.verticalLayout_2 = QtWidgets.QVBoxLayout()
        self.verticalLayout_2.setObjectName("verticalLayout_2")
        self.label_5 = QtWidgets.QLabel(cord)
        self.label_5.setAlignment(QtCore.Qt.AlignCenter)
        self.label_5.setObjectName("label_5")
        self.verticalLayout_2.addWidget(self.label_5)
        self.yp = QtWidgets.QDial(cord)
        self.yp.setMinimum(-100)
        self.yp.setMaximum(100)
        self.yp.setObjectName("yp")

        self.verticalLayout_2.addWidget(self.yp)
        self.lcdy = QtWidgets.QLCDNumber(cord)
        self.lcdy.setSegmentStyle(QtWidgets.QLCDNumber.Flat)
        self.lcdy.setObjectName("lcdy")
        self.verticalLayout_2.addWidget(self.lcdy)
        self.horizontalLayout.addLayout(self.verticalLayout_2)
        self.verticalLayout_5.addLayout(self.horizontalLayout)
        self.horizontalLayout_3 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_3.setObjectName("horizontalLayout_3")
        self.horizontalLayout_2 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_2.setObjectName("horizontalLayout_2")
        self.verticalLayout_3 = QtWidgets.QVBoxLayout()
        self.verticalLayout_3.setObjectName("verticalLayout_3")
        self.label_6 = QtWidgets.QLabel(cord)
        self.label_6.setAlignment(QtCore.Qt.AlignCenter)
        self.label_6.setObjectName("label_6")
        self.verticalLayout_3.addWidget(self.label_6)
        self.xd = QtWidgets.QDial(cord)
        self.xd.setMinimum(1)
        self.xd.setMaximum(100)
        self.xd.setProperty("value", 20)
        self.xd.setObjectName("xd")
        self.verticalLayout_3.addWidget(self.xd)
        self.lcdxd = QtWidgets.QLCDNumber(cord)
        self.lcdxd.setSegmentStyle(QtWidgets.QLCDNumber.Flat)
        self.lcdxd.setObjectName("lcdxd")
        self.verticalLayout_3.addWidget(self.lcdxd)
        self.horizontalLayout_2.addLayout(self.verticalLayout_3)
        self.horizontalLayout_3.addLayout(self.horizontalLayout_2)
        self.verticalLayout_4 = QtWidgets.QVBoxLayout()
        self.verticalLayout_4.setObjectName("verticalLayout_4")
        self.lebal_yd = QtWidgets.QLabel(cord)
        self.lebal_yd.setAlignment(QtCore.Qt.AlignCenter)
        self.lebal_yd.setObjectName("lebal_yd")
        self.verticalLayout_4.addWidget(self.lebal_yd)
        self.yd = QtWidgets.QDial(cord)
        self.yd.setMinimum(1)
        self.yd.setMaximum(100)
        self.yd.setProperty("value", 20)
        self.yd.setObjectName("yd")
        self.verticalLayout_4.addWidget(self.yd)
        self.lcdyd = QtWidgets.QLCDNumber(cord)
        self.lcdyd.setSegmentStyle(QtWidgets.QLCDNumber.Flat)
        self.lcdyd.setObjectName("lcdyd")
        self.verticalLayout_4.addWidget(self.lcdyd)
        self.horizontalLayout_3.addLayout(self.verticalLayout_4)

        self.verticalLayout_x = QtWidgets.QVBoxLayout()
        self.verticalLayout_x.setObjectName("verticalLayout_x")
        self.lebal_dd = QtWidgets.QLabel(cord)
        self.lebal_dd.setAlignment(QtCore.Qt.AlignCenter)
        self.lebal_dd.setObjectName("lebal_dd")

        self.dd = QtWidgets.QDial(cord)
        self.dd.setMinimum(1)
        self.dd.setMaximum(10)
        self.dd.setProperty("value", 1)
        self.dd.setValue(2)
        self.dd.setObjectName("yd")
        self.verticalLayout_x.addWidget(self.lebal_dd)
        self.verticalLayout_x.addWidget(self.dd)

        self.horizontalLayout_3.addLayout(self.verticalLayout_x)

        self.verticalLayout_5.addLayout(self.horizontalLayout_3)
        self.label_10 = QtWidgets.QLabel(cord)
        self.label_10.setMinimumSize(QtCore.QSize(0, 40))
        font = QtGui.QFont()
        font.setPointSize(14)
        self.label_10.setFont(font)
        self.label_10.setTextFormat(QtCore.Qt.AutoText)
        self.label_10.setAlignment(QtCore.Qt.AlignBottom|QtCore.Qt.AlignHCenter)
        self.label_10.setObjectName("label_10")
        self.verticalLayout_5.addWidget(self.label_10)
        self.line_3 = QtWidgets.QFrame(cord)
        self.line_3.setFrameShape(QtWidgets.QFrame.HLine)
        self.line_3.setFrameShadow(QtWidgets.QFrame.Sunken)
        self.line_3.setObjectName("line_3")
        self.verticalLayout_5.addWidget(self.line_3)
        self.aim = QtWidgets.QLabel(cord)
        font = QtGui.QFont()
        font.setPointSize(12)
        self.aim.setFont(font)
        self.aim.setObjectName("aim")
        self.verticalLayout_5.addWidget(self.aim)
        self.verticalLayout_5.setStretch(11, 100)
        self.horizontalLayout_4.addLayout(self.verticalLayout_5)
        self.horizontalLayout_4.setStretch(0, 100)

        self.retranslateUi(cord)
        QtCore.QMetaObject.connectSlotsByName(cord)
        self.x1.valueChanged.connect(self.vc)
        self.x2.valueChanged.connect(self.vc)
        self.x3.valueChanged.connect(self.vc)
        self.y1.valueChanged.connect(self.vc)
        self.y2.valueChanged.connect(self.vc)
        self.y3.valueChanged.connect(self.vc)

        self.xp.valueChanged.connect(self.vc)
        self.yp.valueChanged.connect(self.vc)
        self.xd.valueChanged.connect(self.vc)
        self.yd.valueChanged.connect(self.vc)
        self.dd.valueChanged.connect(self.vcdd)
        self.y3.setValue(-1)
        self.x1.setValue(0.5)
        self.vc()

    def vcdd(self):
        self.xd.setValue(self.dd.value()*10)
        self.yd.setValue(self.dd.value() * 10)
        #self.vc()
        pass
    def vc(self):
        self.img.x[0] = self.x1.value()
        self.img.x[1] = self.x2.value()
        self.img.x[2] = self.x3.value()
        self.img.y[0] = self.y1.value()
        self.img.y[1] = self.y2.value()
        self.img.y[2] = self.y3.value()

        self.img.xp = self.xp.value()/10
        self.lcdx.setProperty('value',self.img.xp)
        self.img.yp = self.yp.value() / 10
        self.lcdy.setProperty('value',self.img.yp)

        self.img.xd = self.xd.value() / 10
        self.lcdxd.setProperty('value', self.img.xd)
        self.img.yd = self.yd.value() /10
        self.lcdyd.setProperty('value', self.img.yd)
        labtxt = ''
        for i in range(3):
            self.img.xa[i] = self.img.x[i]*self.img.xd+self.img.xp
            self.img.ya[i] = self.img.y[i]* self.img.yd + self.img.yp
            labtxt += f'P{i+1}\':({self.img.xa[i]:7.3f},{self.img.ya[i]:7.3f}) \n\n'
        self.aim.setText(labtxt)
        self.update()

    def retranslateUi(self, cord):
        _translate = QtCore.QCoreApplication.translate
        cord.setWindowTitle(_translate("cord", "Form"))
        self.label_7.setText(_translate("cord", "原坐标"))
        self.laby1_3.setText(_translate("cord", "y3"))
        self.label_3.setText(_translate("cord", "x3"))
        self.laby1.setText(_translate("cord", "y1"))
        self.label.setText(_translate("cord", "x1"))
        self.laby1_2.setText(_translate("cord", "y2"))
        self.label_2.setText(_translate("cord", "x2"))
        self.label_8.setText(_translate("cord", "变换"))
        self.label_4.setText(_translate("cord", "X+"))
        self.label_5.setText(_translate("cord", "Y+"))
        self.label_6.setText(_translate("cord", "X乘"))
        self.lebal_yd.setText(_translate("cord", "Y乘"))
        self.lebal_dd.setText(_translate("cord", "XY乘"))
        self.label_10.setText(_translate("cord", "变换后"))
        self.aim.setText(_translate("cord", " "))
        self.yp.setMaximumSize(60, 60)
        self.xp.setMaximumSize(60, 60)
        self.xd.setMaximumSize(60, 60)
        self.yd.setMaximumSize(60, 60)
        self.dd.setMaximumSize(60,60)
        # self.lcdx.setMaximumWidth(60)
        # self.lcdy.setMaximumWidth(60)
